*MIP icin cozucu secimi
option mip = cplex;

*Goreli bosluk toleransi
option optcr = 0.00;

*Mutlak kesim toleransï¿½
option threads = 0.00;
sets
t /1*24 /
n /1*8 /;


scalar

CE_ess /0.9/
DE_ess /0.97/
CE_ev /0.97/
DE_ev /0.98/
t_arrive /1/
t_departure /15/
Psolar_sell /0.35/
K/10000/;

parameters

SoE_ess_ini(n) /
$call=xls2gms r=o20:p27 i=gams3.xlsx o=parc.inc
$include parc.inc
/
SoE_ess_max(n) /
$call=xls2gms r=o2:p9 i=gams3.xlsx o=parc.inc
$include parc.inc
/
SoE_ess_min(n) /
$call=xls2gms r=o11:p18 i=gams3.xlsx o=parc.inc
$include parc.inc

/
SoE_ev_ini(n) /

$call=xls2gms r=u20:v27 i=gams3.xlsx o=parc.inc
$include parc.inc

/


SoE_ev_max(n) /
$call=xls2gms r=u2:v9 i=gams3.xlsx o=parc.inc
$include parc.inc
/


SoE_ev_min(n) /
$call=xls2gms r=u11:v18 i=gams3.xlsx o=parc.inc
$include parc.inc

/

CR_ess(n) /

$call=xls2gms r=r20:s27 i=gams3.xlsx o=parc.inc
$include parc.inc


/
DR_ess(n) /
$call=xls2gms r=r29:s36 i=gams3.xlsx o=parc.inc
$include parc.inc


/
CR_ev(n) /

$call=xls2gms r=r2:s9 i=gams3.xlsx o=parc.inc
$include parc.inc

/
DR_ev(n) /

$call=xls2gms r=r11:s18 i=gams3.xlsx o=parc.inc
$include parc.inc


/

SOE_ev_des(n) /


$call=xls2gms r=u29:v36 i=gams3.xlsx o=parc.inc
$include parc.inc


/;
table
PV(n,t)
$call=xls2gms r=b38:z46 i=gams3.xlsx o=parc.inc
$include parc.inc
;

table
P_buy_grid(n,t)
$call=xls2gms r=b60:z68 i=gams3.xlsx o=parc.inc
$include parc.inc
;

table
Psold_p(n,t)
$call=xls2gms r=b104:z112 i=gams3.xlsx o=parc.inc
$include parc.inc
;

table
P_load(n,t)
$call=xls2gms r=b49:z57 i=gams3.xlsx o=parc.inc
$include parc.inc
;

table
P_buy_p(n,t)
$call=xls2gms r=b93:z101 i=gams3.xlsx o=parc.inc
$include parc.inc
;

table
P_sell(n,t)
$call=xls2gms r=b71:z79 i=gams3.xlsx o=parc.inc
$include parc.inc
;




variable
z,paid;

positive variable
Pv_used(n,t),Pv_sold(n,t),Pbuy_T(n,t),Pess_used(n,t),Pess_sold(n,t),Pess_dis(n,t)
Pess_ch(n,t),SoE_ess(n,t),Pev_ch(n,t),Pev_dis(n,t),Pev_sold(n,t),Pev_used(n,t),Pbuy_G(n,t),
Pbuy_P(n,t),Psell_T(n,t),Psell_G(n,t),Psell_P(n,t),
SoE_ev(n,t);

binary variable
u_pv(n,t),u_ess(n,t),u_ev(n,t);
equation
kisit1,kisit3, kisit4,kisit5,
kisit6,kisit7,kisit8,kisit9,kisit10,kisit11,kisit12,kisit13,
kisit14,kisit15,kisit16,kisit17,kisit18,
kisit21,kisit22,kisit24,kisit25,kisit27,kisit28,
amac,harcanan;


harcanan(n).. paid(n)=e= sum((t),Pbuy_G(n,t)*P_buy_grid(n,t));
amac.. z=e= sum((n,t),Pbuy_G(n,t)*P_buy_grid(n,t));



kisit28(n,t).. Pbuy_T(n,t)=e=Pbuy_G(n,t);



kisit1(n,t).. Pv_used(n,t) =l= PV(n,t);

kisit3(n,t).. Pbuy_T(n,t)=l= K;


kisit4(n,t).. Pbuy_T(n,t)+Pv_used(n,t)+Pev_used(n,t)+Pess_used(n,t)=e=P_load(n,t)+Pev_ch(n,t)+Pess_ch(n,t);




kisit5(n,t).. Pess_used(n,t)=e=Pess_dis(n,t)*DE_ess;
kisit6(n,t).. Pess_ch(n,t)=l=CR_ess(n)*u_ess(n,t);
kisit7(n,t).. Pess_dis(n,t)=l=DR_ess(n)*(1-u_ess(n,t));
kisit8(n,t) $(ord(t)>=1).. SoE_ess(n,t)=e=SoE_ess(n,t-1)+CE_ess*Pess_ch(n,t)-Pess_dis(n,t);
kisit9(n,t) $(ord(t)=1).. SoE_ess(n,t)=e=SoE_ess_ini(n);
kisit10(n,t)..SoE_ess(n,t)=l= SoE_ess_max(n);
kisit11(n,t)..SoE_ess(n,t)=g= SoE_ess_min(n);


kisit12(n,t)$(ord(t)>=t_arrive and ord(t)<=t_departure).. Pev_used(n,t)=e=Pev_dis(n,t)*DE_ev;

kisit13(n,t)$(ord(t)>=t_arrive and ord(t)<=t_departure).. Pev_ch(n,t)=l=CR_ev(n)*u_ev(n,t);

kisit14(n,t)$(ord(t)>=t_arrive and ord(t)<=t_departure).. Pev_dis(n,t)=l=DR_ev(n)*(1-u_ev(n,t));

kisit15(n,t)$(ord(t)>t_arrive and ord(t)<=t_departure).. SoE_ev(n,t)=e=SoE_ev(n,t-1)+CE_ev*Pev_ch(n,t)-Pev_dis(n,t);

kisit16(n,t)$(ord(t)=t_arrive).. SoE_ev(n,t)=e=SoE_ev_ini(n)+CE_ev*Pev_ch(n,t)-Pev_dis(n,t);

kisit17(n,t).. SoE_ev(n,t)=l=SoE_ev_max(n);

kisit18(n,t).. SoE_ev(n,t)=g=SoE_ev_min(n);


kisit21(n,t)$(ord(t)>t_departure).. SoE_ev(n,t)=e=0;

kisit22(n,t)$(ord(t)>t_departure).. Pev_used(n,t)=e=0;


kisit24(n,t)$(ord(t)>t_departure).. Pev_ch(n,t)=e=0;

kisit25(n,t)$(ord(t)>t_departure).. Pev_dis(n,t)=e=0;


kisit27(n,t)$(t_departure=ord(t)).. SOE_ev(n,t)=e=SOE_ev_des(n);






model ornek1 /all/;

solve ornek1 using MIP minimizing z;

display

Pv_used.l,

Pbuy_T.l,
Pess_used.l,

Pess_dis.l,
Pess_ch.l,
SoE_ess.l,
Pev_ch.l,
Pev_dis.l,

Pev_used.l,
Pbuy_G.l,

Pbuy_T.l,


SoE_ev.l,
paid.l ;


Execute "xlstalk -S output21.xlsx"

Execute_unload "output21" n Pv_used.l  Pbuy_T.l Pess_used.l  Pess_dis.l Pess_ch.l
SoE_ess.l Pev_ch.l Pev_dis.l Pev_used.l Pbuy_G.l
SoE_ev.l kisit4.l paid.l;


Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pev_used.L Rng=output12!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pess_used.L Rng=output8!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pv_used.L Rng=output15!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pev_ch.L Rng=output10!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pess_ch.L Rng=output7!B2'



Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pbuy_T.L Rng=output1!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pbuy_G.L Rng=output2!B2'








Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pev_dis.L Rng=output11!B2'



Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=Pess_dis.L Rng=output16!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=SoE_ess.L Rng=output17!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=SoE_ev.L Rng=output18!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Par=P_load.L Rng=output19!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Equ=kisit4.L Rng=output20!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Var=paid.L Rng=output23!B2'
Execute 'GDXXRW.EXE output21.gdx O=output21.xlsx Set=n Rng=output21!B2'

Execute "=shellexecute output21.xlsx" ;
